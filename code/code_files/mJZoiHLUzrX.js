if (self.CavalryLogger) { CavalryLogger.start_js(["Cf3G9"]); }

__d("MInitJewelCounts",["Stratcom"],(function a(b,c,d,e,f,g,h){"use strict";var i=[],j=false;function k(n){h.invoke("m:jewels:init-counts",null,n)}function l(n){k(n);if(!j)i.push(n)}function m(){if(j)return;j=true;var n=i.splice(0,i.length);n.forEach(function(o){k(o)})}f.exports={main:l,replayMissedEvents:m}}),null);
__d("Popover",["setTimeoutAcrossTransitions","CSS","DOM","MAria","MViewport","Stratcom","Vector","$","eventsMixinDeprecated"],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=40;function r(s){"use strict";var t=s.flyout;this.flyout=typeof t=="string"?o(t):t;this.content=j.scry(this.flyout,"div","flyout-content")[0];this.options=s;this._onOrientationChange=this._reposition.bind(this);this.jewelRedirect=s.jewelRedirect;i.conditionClass(this.flyout,"popover_flyout",true);var u=s.button;if(u){this.button=typeof u=="string"?o(u):u;this.buttonClickListener=j.listen(this.button,"click",null,this._openHandler.bind(this));this.button.setAttribute("role","button");k.setupPopup(this.button,this.flyout)}var v=s.flyoutAnchor;if(v)this.flyoutAnchor=typeof v=="string"?o(v):v;else this.flyoutAnchor=this.button;if(this.options.flyoutFromRoot)this.flyoutClickListener=j.listen(this.flyout,"click",null,this._openHandler.bind(this));if(this.options.touchstart_callback)this.flyoutTouchStartListener=j.listen(this.flyout,"touchstart",null,this._touchStartHandler.bind(this));if(this.options.touchmove_callback)this.flyoutTouchMoveListener=j.listen(this.flyout,"touchmove",null,this._touchMoveHandler.bind(this));if(this.options.touchend_callback)this.flyoutTouchEndListener=j.listen(this.flyout,"touchend",null,this._touchEndHandler.bind(this));r._instances[this.flyout.id]=this}r.prototype.isOpen=function(){"use strict";return!!this._isOpen};r.prototype.open=function(){"use strict";if(this.isOpen())return;if(r._activePopover)r._activePopover.close();r._activePopover=this;this._isOpen=true;this.constraint=null;if(!this.jewelRedirect)i.conditionClass(this.flyout,"popover_hidden",false);if(this.options.flyoutFromRoot)this._absolutePositionFlyout();this._position();if(!this.options.heightConstraint){i.conditionClass(document.body,"disableClicks",true);this.globalListener=m.listenCapture("click",null,this._closeHandler.bind(this))}window.addEventListener("orientationchange",this._onOrientationChange,false);k.showPopup(this.button,this.flyout);if(this.options.ensureVisible){var s=l.getScrollTop(),t=this._getElementPosition(this.flyout).y,u=t+this.flyout.offsetHeight,v=u-(s+l.getUseableHeight());if(v>0){var w=Math.min(v,Math.max(t-s-q,0));l.scrollTo(0,s+w)}}this.invoke("open")};r.prototype.close=function(s){"use strict";if(!this.isOpen())return;r._activePopover=null;this._isOpen=false;i.conditionClass(this.flyout,"popover_hidden",true);if(this.options.flyoutFromRoot){this.flyoutParent.appendChild(this.flyout);delete this.flyoutParent}h(function(){i.conditionClass(document.body,"disableClicks",false)}.bind(this),400);this.globalListener&&this.globalListener.remove();window.removeEventListener("orientationchange",this._onOrientationChange,false);this._releaseConstraint();k.hidePopup(this.button,this.flyout);if(!s)this.invoke("close")};r.prototype.clear=function(){"use strict";this.globalListener&&this.globalListener.remove();this.buttonClickListener&&this.buttonClickListener.remove();this.flyoutClickListener&&this.flyoutClickListener.remove();this.flyoutTouchStartListener&&this.flyoutTouchStartListener.remove();this.flyoutTouchMoveListener&&this.flyoutTouchMoveListener.remove();this.flyoutTouchEndListener&&this.flyoutTouchEndListener.remove();delete r._instances[this.flyout.id]};r.prototype.refreshConstraints=function(){"use strict";if(!this._isOpen||this.jewelRedirect)return false;var s=this.flyout;this._releaseConstraint();if(this.options.heightConstraint){s.style.minHeight=l.getUseableHeight()+"px";this.constraint=l.addHeightConstraint(n.getDim(this.content).y+this._getElementPosition(s).y)}else this.constraint=l.addMinHeightConstraint(n.getDim(s).y+this._getElementPosition(s).y+r._MARGIN)};r.prototype._getTouchPoint=function(event){"use strict";var s=event.getRawEvent().targetTouches[0],t={x:s?s.screenX:0,y:s?s.screenY:0};return t};r.prototype._touchStartHandler=function(event){"use strict";this.options.touchstart_callback(this._getTouchPoint(event))};r.prototype._touchMoveHandler=function(event){"use strict";if(this.isOpen())this.options.touchmove_callback(this._getTouchPoint(event))};r.prototype._touchEndHandler=function(event){"use strict";this.options.touchend_callback(this._getTouchPoint(event))};r.prototype._openHandler=function(event){"use strict";if(!this.jewelRedirect)event.prevent();var s=this.isOpen();if(s&&!this.options.preventClose)this.close();else if(!s){var t=j.scry(document,"input");for(var u=0;u<t.length;u++)t[u].blur();this.open()}};r.prototype._closeHandler=function(event){"use strict";if(!event.getNode("popover"))this.close()};r.prototype._getElementPosition=function(s){"use strict";var t=s.offsetLeft,u=s.offsetTop;s=s.offsetParent;while(s&&s!==document.documentElement){t+=s.offsetLeft;u+=s.offsetTop;var v=window.getComputedStyle(s);t+=parseInt(v.getPropertyValue("border-left-width").slice(0,-2),10);u+=parseInt(v.getPropertyValue("border-top-width").slice(0,-2),10);s=s.offsetParent}return new n(t,u)};r.prototype._absolutePositionFlyout=function(){"use strict";this.flyoutParent=this.flyout.parentNode;o("root").appendChild(this.flyout);var s=this._getElementPosition(this.flyout.parentNode),t=this._getElementPosition(this.flyoutAnchor),u=n.getDim(this.flyoutAnchor),v=t.y-s.y+u.y;this.flyout.style.position="absolute";this.flyout.style.top=v+"px"};r.prototype._position=function(){"use strict";var s=this.flyout;if(this.flyoutAnchor&&this.options.positionNub){var t=this._getElementPosition(this.flyoutAnchor),u=j.find(this.flyout,"*","nub"),v=n.getDim(u).x,w=n.getDim(this.flyoutAnchor).x,x=this._getElementPosition(s);new n(t.x-x.x+(w-v)/2,0).setPos(u)}this.refreshConstraints()};r.prototype._reposition=function(){"use strict";h(this._position.bind(this),0)};r.prototype._releaseConstraint=function(){"use strict";if(this.constraint){this.constraint.release();this.constraint=null}};r.getInstance=function(s){"use strict";return r._instances[s]};r.clearAll=function(){"use strict";for(var s=0;s<r._instances.length;s++)r._instances[s].clear()};p(r,["open","close"]);Object.assign(r,{_activePopover:null,_MARGIN:40,_instances:{}});f.exports=r}),null);
__d("MJewel",["CSS","DOM","MHistory","MJSEnvironment","MLogState","MTabbable","MViewport","Popover","Stratcom","URI","$","eventsMixinDeprecated","intlNumUtils","setTimeoutAcrossTransitions"],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v=10,w="/friends/center/requests/";function x(y,z){"use strict";this._sigil=y;this.options=z||{};this._jewelNode=r(x.JEWEL_NAV_NODE_ID);this._softState=z.softState||"jewel="+x.nextID++;this._duringInit=false;this.jewelRedirect=z.jewelRedirect;this._createPopover();p.listen("m:history:change",null,this._updateJewelsOnHistoryChange.bind(this))}x.prototype._updateJewelsOnHistoryChange=function(event){"use strict";var y=new q(event.getData().path),z=y.getPath(),A=this.jewelRedirect&&this.isOpen()&&!event.getData().soft&&z===w;if(event.getData().soft===this._softState||A)this._popover&&this._popover.open();else this._popover&&this._popover.close()};x.prototype.isInitialized=function(){"use strict";var y=this.options.contentsSigil||"contents";return!!i.scry(this._jewelNode,"*",y)[0]};x.prototype._getJewelElement=function(){"use strict";return i.find(this._jewelNode,"div",this._sigil)};x.prototype._getCountElement=function(){"use strict";return i.find(this._getJewelElement(),"span","count")};x.prototype._getContentsElement=function(){"use strict";var y=this.options.contentsSigil||"contents";return i.find(this._getJewelElement(),"*",y)};x.prototype._getFlyoutElement=function(){"use strict";return i.find(this._getJewelElement(),"*","flyout")};x.prototype.getCount=function(){"use strict";return this._count};x.prototype.setDuringInit=function(y){"use strict";this._duringInit=y};x.prototype._updateCountElement=function(){"use strict";var y=this._getJewelCount();i.setContent(this._getCountElement(),t.formatNumberWithThousandDelimiters(y||0));var z=this._getJewelElement(),A=this._count>0;h.conditionClass(z,"noCount",!A);h.conditionClass(z,"hasCount",A)};x.prototype.setCount=function(y){"use strict";if(y<0)return;this._count=y;this._updateCountElement()};x.prototype.setHeaderText=function(y,z){"use strict";if(!y||!z)return;var A=this._getFlyoutElement();if(!A)return;var B=i.scry(A,"*",y)[0];if(!B)return;var C=B.cloneNode(true);C.innerText=z;i.replace(B,C)};x.prototype.handleViewedContent=function(){"use strict";if(this.getCount()>0&&this.isInitialized()){this.setCount(0);this.invoke("cleared")}else this.invoke("jewel_click")};x.prototype.setMenuContent=function(y){"use strict";i.setContent(this._getFlyoutElement(),y);if(this.isOpen())this.handleViewedContent()};x.prototype.prependMenuContent=function(y){"use strict";i.prependContent(this._getContentsElement(),y)};x.prototype.removeMenuContent=function(y){"use strict";var z=document.getElementById(y);if(z)i.remove(z)};x.prototype.updateMenuColor=function(y,z,A){"use strict";A?u(this._updateMenuColor.bind(this,y,z),x.MARK_READ_DELAY):this._updateMenuColor(y,z)};x.prototype._updateMenuColor=function(y,z){"use strict";var A=document.getElementById(y);if(A){h.conditionClass(A,x.M_AREA_LIGHTBLUE,!z);h.conditionClass(A,x.M_AREA_WHITE,z)}};x.prototype._createPopover=function(){"use strict";var y=this._getJewelElement(),z=i.find(y,"div","flyout");this._popover=new o({button:i.find(y,"*","icon"),flyout:z,ensureVisible:false,heightConstraint:true,preventClose:true,jewelRedirect:this.jewelRedirect});this._onOpenListener=this._popover.listen("open",this._onOpen.bind(this));this._onCloseListener=this._popover.listen("close",this._onClose.bind(this));this._popoverClickListener=i.listen(z,"click",null,this._onPopoverClick.bind(this));if(k.IS_ANDROID&&k.GET_OS_VERSION>=4)this._scrollAreaNode=i.scry(z,"div","scroll-area")[0]};x.prototype.clear=function(){"use strict";this._onOpenListener&&this._onOpenListener.remove();this._onCloseListener&&this._onCloseListener.remove();this._popoverClickListener&&this._popoverClickListener.remove();this._popoverTouchStartListener&&this._popoverTouchStartListener.remove();this._touchMoveListener&&this._touchMoveListener.remove();this._touchStartListener&&this._touchStartListener.remove();this._popover&&this._popover.clear()};x.prototype._onPopoverClick=function(event){"use strict";l.updateLink(event,this.options.pos);this.options.clickCallback&&this.options.clickCallback(event)};x.prototype._onPopoverTouchStart=function(event){"use strict";event.kill()};x.prototype._getJewelCount=function(){"use strict";if(this._count>0)return this._count;else return this._unreadCount};x.prototype._onOpen=function(){"use strict";if(this._scrollAreaNode){n.scrollToHeader();var y=document.documentElement;h.conditionClass(y,"hide-scroll",true);this._scrollAreaNode.style.maxHeight=y.offsetHeight-200+"px"}var z=this._getJewelCount();j.pushSoftState(this._softState);this.handleViewedContent();p.invoke("m:jewel:flyout:open",null,{jewel:this._sigil});h.conditionClass(this._getJewelElement(),"popoverOpen",true);var A=i.find(this._getJewelElement(),"div","flyout");m.focusTabbable(A)};x.prototype._onClose=function(){"use strict";if(this._scrollAreaNode){this._scrollAreaNode.style.minHeight="";h.conditionClass(document.documentElement,"hide-scroll",false)}p.invoke("m:jewel:flyout:close",null,{jewel:this._sigil});h.conditionClass(this._getJewelElement(),"popoverOpen",false);j.popSoftState(this._softState)};x.prototype.isOpen=function(){"use strict";return this._popover&&this._popover.isOpen()};x.prototype.openPopover=function(){"use strict";this._popover&&!this._popover.isOpen()&&this._popover.open()};x.prototype.reregisterListeners=function(){"use strict";var y=this.isOpen();this.clear();this._createPopover();if(y)this._popover.open()};s(x,["cleared","jewel_click"]);Object.assign(x,{M_AREA_WHITE:"acw",M_AREA_LIGHTBLUE:"aclb",MARK_READ_DELAY:3e3,JEWEL_NAV_NODE_ID:"mJewelNav",nextID:0});Object.assign(x.prototype,{_sigil:null,_currentJewel:null,_count:0,_popover:null});f.exports=x}),null);
__d("FriendingSurfaceVisitationTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function a(b,c,d,e,f,g,h,i,j){"use strict";function k(){this.clear()}k.prototype.log=function(){i.log("logger:FriendingSurfaceVisitationLoggerConfig",this.$FriendingSurfaceVisitationTypedLogger1,h.BASIC)};k.prototype.logVital=function(){i.log("logger:FriendingSurfaceVisitationLoggerConfig",this.$FriendingSurfaceVisitationTypedLogger1,h.VITAL)};k.prototype.clear=function(){this.$FriendingSurfaceVisitationTypedLogger1={};return this};k.prototype.updateData=function(m){this.$FriendingSurfaceVisitationTypedLogger1=babelHelpers["extends"]({},this.$FriendingSurfaceVisitationTypedLogger1,m);return this};k.prototype.setAppVersion=function(m){this.$FriendingSurfaceVisitationTypedLogger1.app_version=m;return this};k.prototype.setBadgeCount=function(m){this.$FriendingSurfaceVisitationTypedLogger1.badge_count=m;return this};k.prototype.setClientTimestamp=function(m){this.$FriendingSurfaceVisitationTypedLogger1.client_timestamp=m;return this};k.prototype.setRawRefTab=function(m){this.$FriendingSurfaceVisitationTypedLogger1.raw_ref_tab=m;return this};k.prototype.setRawTab=function(m){this.$FriendingSurfaceVisitationTypedLogger1.raw_tab=m;return this};k.prototype.setRefPage=function(m){this.$FriendingSurfaceVisitationTypedLogger1.ref_page=m;return this};k.prototype.setSurface=function(m){this.$FriendingSurfaceVisitationTypedLogger1.surface=m;return this};k.prototype.setTargetProfileID=function(m){this.$FriendingSurfaceVisitationTypedLogger1.target_profile_id=m;return this};k.prototype.setVC=function(m){this.$FriendingSurfaceVisitationTypedLogger1.vc=m;return this};var l={app_version:true,badge_count:true,client_timestamp:true,raw_ref_tab:true,raw_tab:true,ref_page:true,surface:true,target_profile_id:true,vc:true};f.exports=k}),null);
__d("XFriendRequestIHEventLoggingController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/requests/interaction_history_logging/",{target_id:{type:"FBID",required:true},log_event:{type:"String",required:true}})}),null);
__d("MFriendRequestIHEventLogger",["DOM","FBJSON","MRequest","XFriendRequestIHEventLoggingController"],(function a(b,c,d,e,f,g,h,i,j,k){var l={listenToProfileClick:function m(n,o,p){var q=i.parse(n.getAttribute("data-store")),r=q.userid?q.userid.toString():null;h.listen(p,"click",null,function(){this.logClick(r)}.bind(this));h.listen(o,"click",null,function(){this.logClick(r)}.bind(this))},logImpression:function m(n){if(n)this._logEvent(n,"impression")},logClick:function m(n){if(n)this._logEvent(n,"click")},_logEvent:function m(n,event){if(isNaN(n))return;var o=k.getURIBuilder().setFBID("target_id",n).setString("log_event",event).getURI();new j(o).send()}};f.exports=l}),null);
__d("MJewels",[],(function a(b,c,d,e,f,g){f.exports={REQUESTS:"requests",MESSAGES:"messages",NOTIFICATIONS:"notifications",SEARCH:"search",MORE:"more",NEWS_FEED:"news-feed",BOOKMARKS:"bookmarks",VIDEOS:"videos",CASUAL_GROUPS:"casual_groups"}}),null);
__d("XCasualGroupsJewelTabActivityController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/mobile/casual_groups/jewel/update_activity/",{})}),null);
__d("XFBConfirmationCliffTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function a(b,c,d,e,f,g,h,i,j){"use strict";function k(){this.clear()}k.prototype.log=function(){i.log("logger:XFBConfirmationCliffLoggerConfig",this.$XFBConfirmationCliffTypedLogger1,h.BASIC)};k.prototype.logVital=function(){i.log("logger:XFBConfirmationCliffLoggerConfig",this.$XFBConfirmationCliffTypedLogger1,h.VITAL)};k.prototype.clear=function(){this.$XFBConfirmationCliffTypedLogger1={};return this};k.prototype.updateData=function(m){this.$XFBConfirmationCliffTypedLogger1=babelHelpers["extends"]({},this.$XFBConfirmationCliffTypedLogger1,m);return this};k.prototype.setCliffCaller=function(m){this.$XFBConfirmationCliffTypedLogger1.cliff_caller=m;return this};k.prototype.setError=function(m){this.$XFBConfirmationCliffTypedLogger1.error=m;return this};k.prototype.setSurface=function(m){this.$XFBConfirmationCliffTypedLogger1.surface=m;return this};k.prototype.updateExtraData=function(m){m=j(i.serializeMap(m));i.checkExtraDataFieldNames(m,l);this.$XFBConfirmationCliffTypedLogger1=babelHelpers["extends"]({},this.$XFBConfirmationCliffTypedLogger1,m);return this};k.prototype.addToExtraData=function(m,n){var o={};o[m]=n;return this.updateExtraData(o)};var l={cliff_caller:true,error:true,surface:true};f.exports=k}),null);
__d("XMessagesJewelContentController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/mobile/messages/jewel/content/",{spinner_id:{type:"String",required:true}})}),null);
__d("XNotificationJewelContentController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/mobile/notifications/jewel/content/",{spinner_id:{type:"String",required:true}})}),null);
__d("MJewelSet",["Banzai","BanzaiLogger","ChannelEventType","DOM","EventListener","FriendingSurfaceVisitationTypedLogger","MarauderLogger","MessagingEvent","MFriendRequestIHEventLogger","MInitJewelCounts","MJewel","MJewels","MLegacyDataStore","MLogState","MPymkFunnelLogger","MRequest","MTouchChannelManager","MURI","MViewport","Popover","ScriptPath","Stratcom","XCasualGroupsJewelTabActivityController","XFBConfirmationCliffTypedLogger","XMessagesJewelContentController","XNotificationJewelContentController","fbt","throttle"],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I){var J={_viewerID:null,_requestsJewel:null,_messagesJewel:null,_notificationsJewel:null,_unseenNotificationIds:{},_unseenThreadIDs:{},_unreadThreadIDs:{},_jewelClickLogListener:null,_messengerCliff:false,_haveInitializedJewels:false,_pymkAndRequestImpressionLogged:false,MSG_ID_PREFIX:"msg_",OTHER_USER_FBID_PREFIX:"other_user_fbid_",THREAD_FBID_PREFIX:"thread_fbid_",NOTIF_ID_PREFIX:"notif_",JEWEL_NAV_NODE_ID:"mJewelNav",JEWEL_NAV_CACHE_KEY:"mJewelNavKey",JEWEL_MSG_LIST:"mJewelMsgThreadContents",_lazyLoadNotificationsReq:null,_lazyLoadMessagesReq:null,_hasCombinedTab:false,_diodeBadgeableQPCount:0,createJewels:function K(L){if(L.showRequests){J._requestsJewel=new r("requests",{pos:u.CLICK_POSITION_REQUESTS_FLYOUT,softState:s.REQUESTS,jewelRedirect:L.shouldRedirectRequestsJewel},"friends_jewel_module");J._requestsJewel.listen("cleared",J._markRequestsRead);J._requestsJewel.listen("jewel_click",J._logRequestsJewelClick)}if(L.showCasualGroups){J._casualGroupsJewel=new r("casual_groups",{softState:s.CASUAL_GROUPS},"casual_groups_jewel_module");J._casualGroupsJewel.listen("jewel_click",J._updateCasualGroupsTabActivity)}if(L.hasCombinedTab)J._hasCombinedTab=true;J._messagesJewel=new r("messages",{contentsSigil:J.JEWEL_MSG_LIST,pos:u.CLICK_POSITION_MESSAGES_FLYOUT,softState:s.MESSAGES},"messages_jewel_module");J._messagesJewel.listen("cleared",J._markMessagesRead);J._notificationsJewel=new r("notifications",{pos:u.CLICK_POSITION_NOTIFICATIONS_FLYOUT,softState:s.NOTIFICATIONS},"notifications_jewel_module");J._notificationsJewel.listen("cleared",J._markNotificationsSeen);J._jewelClickLogListener=J._notificationsJewel.listen("jewel_click",J._logNotificationJewelClick);C.listen("m:jewel:flyout:open",null,J._onJewelOpen)},openMessageJewel:function K(){J._messagesJewel.openPopover()},setMessengerCliff:function K(L,M,N){J._messengerCliff=L},setMessengerCliffShouldLog:function K(L,M){},markFriendRequestsSeen:function K(event){if(J._requestsJewel===null)return;J._requestsJewel.setCount(0)},updateFriendRequests:function K(event){if(J._requestsJewel===null)return;if(J._requestsJewel.isOpen())return;var L=new w("/ajax/mobile/friends/jewel/requests_markup");L.send()},onAfterUpdateFriendRequests:function K(L){if(J._requestsJewel===null)return;J._setJewelCount(J._requestsJewel,L,J._markRequestsRead);A.getInstance("reqs_flyout").refreshConstraints();if(J._requestsJewel.isOpen()){var M=J._requestsJewel._getContentsElement();J._logPymkAndRequestImpression(M)}},onAfterLoadMoreFriendSuggestions:function K(){if(J._requestsJewel===null)return;A.getInstance("reqs_flyout").refreshConstraints()},onCombinedTabAsyncLoad:function K(){if(J._notificationsJewel&&J._notificationsJewel.isOpen()){var L=J._notificationsJewel._getContentsElement();J._logPymkAndRequestImpression(L)}},_logPymkAndRequestImpression:function K(L){if(J._pymkAndRequestImpressionLogged)return;J._pymkAndRequestImpressionLogged=true;var M=k.scry(L,"div","undoable-action");for(var N=0;N<M.length;N++){var O=M[N].getAttribute("data-pymk-id");if(O){var P=M[N].getAttribute("data-signature");v.logImpression(O,P,"mobile_jewel")}else{var Q=t.get(M[N]).userid;n.log("request_seen","friend_request_waterfall",{request_id:Q,request_location:"requests_jewel"});p.logImpression(Q?Q.toString():null)}}},refreshNotificationsConstraints:function K(){A.getInstance("notifications_flyout").refreshConstraints()},refreshNotificationsConstraintsOnImageLoad:function K(){var L=document.getElementById("notifications_flyout");if(!L)return;J.refreshNotificationsConstraints();var M=I(J.refreshNotificationsConstraints,500);k.scry(L,"img","notif_thumb").forEach(function(N){var O=l.listen(N,"load",function(){O.remove();M()})})},refreshMessagesConstraints:function K(){A.getInstance("messages_flyout").refreshConstraints()},updateNotification:function K(event){var L=event.getData();if(L&&L.data){if(L.data.type==="friend_confirmed")return;if(!J._notificationsJewel.isOpen()&&!J._unseenNotificationIds[L.data.alert_id])J._notificationsJewel.setCount(L.data.unread+J._notificationsJewel.getCount());J._notificationsJewel.removeMenuContent(J._getNotifNodeID(L.data.alert_id));J._unseenNotificationIds[L.data.alert_id]=true;if(J._notificationsJewel.isOpen())J._markNotificationsSeen();J._loadNotificationJewelContent()}},updateUnseenNotificationIds:function K(event){var L=event.getData();if(!L)return;var M=event.getType()=="notifications_read";if(L.alert_ids){var N=0;for(var O=0;O<L.alert_ids.length;O++)if(J._unseenNotificationIds[L.alert_ids[O]]){delete J._unseenNotificationIds[L.alert_ids[O]];M&&J._notificationsJewel.updateMenuColor(J._getNotifNodeID(L.alert_ids[O]),true,false);N++}var P=J._notificationsJewel.getCount();J._notificationsJewel.setCount(P-N)}else{J._notificationsJewel.setCount(0);if(M)for(var Q in J._unseenNotificationIds)J._notificationsJewel.updateMenuColor(J._getNotifNodeID(Q),true,false);J._unseenNotificationIds={}}},updateMessageCounts:function K(event){var L=event.getData();if(!L)return;if(L.event===o.READ&&L.message.folder==="inbox"){var M=L.message.thread_fbid||L.message.other_user_fbid;delete J._unseenThreadIDs[M];delete J._unreadThreadIDs[M]}else if(L.event===o.UNREAD&&L.message.folder==="inbox"){var N=L.message.thread_fbid||L.message.other_user_fbid;J._unreadThreadIDs[N]=1}else if(L.event===o.MARK_ALL_READ&&L.message.folder==="inbox"){J._unreadThreadIDs={};J._unseenThreadIDs={}}else if(L.event===o.MARK_ALL_SEEN&&L.message.folder==="inbox")J._unseenThreadIDs={};else if(L.parsedPayload&&L.folder==="inbox"){var O=L.parsedPayload;if(!J._viewerIsAParticipant(J._viewerID,O)||O.isUnread()===false||L.message.is_muted)return;var P=O.getThreadFBID()||O.getOtherUserFBID();J._unseenThreadIDs[P]=1;J._unreadThreadIDs[P]=1}else return;var Q=Object.keys(J._unseenThreadIDs).length,R=Object.keys(J._unreadThreadIDs).length;if(!J._messagesJewel.isOpen()&&Q!==J._messagesJewel.getCount())J._messagesJewel.setCount(Q+J._diodeBadgeableQPCount);var S=R>0?H._("\u8a0a\u606f\uff08{unread_message_count}\uff09",[H.param("unread_message_count",R)]):H._("\u8a0a\u606f");J._messagesJewel.setHeaderText("messages_jewel_header_text",S)},updateMessage:function K(event){var L=event.getData();if(!L)return;if(L.parsedPayload){var M=L.parsedPayload;if(M.getFolder()!=="inbox"||!J._viewerIsAParticipant(J._viewerID,M))return;if(J._messagesJewel.isInitialized()){J._messagesJewel.removeMenuContent(J._getMessageNodeID(M.getOtherUserFBID(),M.getThreadFBID()));if(J._messagesJewel.isOpen())J._markMessagesRead()}J._loadMessagesJewelContent()}else if(L.event===o.READ&&L.is_sync)J._messagesJewel.updateMenuColor(J._getMessageNodeID(L.message.other_user_fbid,L.message.thread_fbid),true,false)},_getMessageNodeID:function K(L,M){L=L?L:"";M=M?M:"";return J.MSG_ID_PREFIX+J.OTHER_USER_FBID_PREFIX+L+J.THREAD_FBID_PREFIX+M},_getNotifNodeID:function K(L){return J.NOTIF_ID_PREFIX+L},_markRequestsRead:function K(){C.invoke("m_requests_jewel_mark_read");var L=new w(new y("/a/jewel_requests_read.php").toString());L.send()},_markMessagesRead:function K(){var L=new w(new y("/a/jewel_messages_read.php").toString());L.send()},_markNotificationsSeen:function K(){if(J._jewelClickLogListener){J._jewelClickLogListener.remove();J._jewelClickLogListener=null}if(J._hasCombinedTab)J._markRequestsRead();var L=J._unseenNotificationIds;J._unseenNotificationIds={};var M=[];for(var N in L)M.push(N);var O=new w(new y("/a/jewel_notifications_read.php").toString());O.addData({ids:M,count:M.length,seen:true});O.send()},_onJewelOpen:function K(event){var L=event.getData();if(L&&L.jewel)if(L.jewel==="notifications")J._loadNotificationJewelContent();else if(L.jewel==="messages"){if(J._messengerCliff)new E().setSurface("messenger_seen").log();var M=J._messagesJewel.getCount()-J._diodeBadgeableQPCount;J._messagesJewel.setCount(M);J._diodeBadgeableQPCount=0;J._loadMessagesJewelContent()}B.set("topbar_"+L.jewel)},_loadNotificationJewelContent:function K(){var L=J._notificationsJewel._getContentsElement(),M="notifications-flyout-loading";if(C.hasSigil(L,M)){var N=G.getURIBuilder().setString("spinner_id",L.getAttribute("id")).getURI();if(!J._lazyLoadNotificationsReq){J._lazyLoadNotificationsReq=new w(N);J._lazyLoadNotificationsReq.listen("finally",function(){J._lazyLoadNotificationsReq=null});J._lazyLoadNotificationsReq.send()}}},_loadMessagesJewelContent:function K(){var L=J._messagesJewel._getJewelElement(),M="messages-flyout-loading",N=k.scry(L,"*",M);if(N.length>0){var O=F.getURIBuilder().setString("spinner_id",N[0].getAttribute("id")).getURI();if(!J._lazyLoadMessagesReq){J._lazyLoadMessagesReq=new w(O);J._lazyLoadMessagesReq.listen("finally",function(){J._lazyLoadMessagesReq=null});J._lazyLoadMessagesReq.send()}}},_logNotificationJewelClick:function K(){if(J._jewelClickLogListener){J._jewelClickLogListener.remove();J._jewelClickLogListener=null}if(J._hasCombinedTab){var L=J._notificationsJewel._getContentsElement();J._logRequestsImpessions(L);if(J._notificationsJewel.isOpen())if(!C.hasSigil(L,"notifications-flyout-loading"))J._logPymkAndRequestImpression(L)}new w("/a/jewel_notifications_log.php").addData({click_type:"jewel_click",count:J._notificationsJewel.getCount()}).send()},_updateCasualGroupsTabActivity:function K(){var L=D.getURIBuilder().getURI();if(!J._updateCasualGroupsTabActivityReq){J._updateCasualGroupsTabActivityReq=new w(L);J._updateCasualGroupsTabActivityReq.listen("finally",function(){J._updateCasualGroupsTabActivityReq=null});J._updateCasualGroupsTabActivityReq.send()}J._casualGroupsJewel.setCount(0)},_logRequestsJewelClick:function K(){var L=J._requestsJewel._getContentsElement();J._logRequestsImpessions(L);new m().setSurface("jewel").setBadgeCount(J._requestsJewel.getCount()).log();if(J._requestsJewel.isOpen())if(C.hasSigil(L,"requests-flyout-loading"))new w("/ajax/mobile/friends/jewel/requests_markup").send();else{var M=J._requestsJewel._getContentsElement();J._logPymkAndRequestImpression(M)}},_logRequestsImpessions:function K(L){if(!L)return;var M=k.scry(L,"div","attachment"),N=[];for(var O=0;O<M.length;O++){var P=M[O].getAttribute("id");if(P&&P.startsWith("m_jewel_req_"))N=N.concat(P.replace("m_jewel_req_",""))}if(N.length){var Q=new w("/friends/requests/log_impressions");Q.setMethod("POST");Q.addData({ids:N.join(","),ref:"m_jewel"});Q.send()}},_viewerIsAParticipant:function K(L,M){if(!M.getParticipantIDs())return false;if(M.getParticipantIDs().indexOf(L)>-1)return true;return M.getParticipantIDs().indexOf(L.toString())>-1},_initJewelCount:function K(L,M,N){L.setDuringInit(true);L.reregisterListeners();J._setJewelCount(L,M,N);L.setDuringInit(false)},_setJewelCount:function K(L,M,N){if(!L.isOpen())L.setCount(M);else if(M)N()},_initJewelCounts:function K(event){var L=event.getData();J.initJewels(null,null);if(L.viewer_id)J._viewerID=L.viewer_id;if(L.unread_notification_ids)J._unseenNotificationIds=L.unread_notification_ids||{};if(L.unseen_thread_ids)J._unseenThreadIDs=L.unseen_thread_ids.reduce(function(O,P){O[P]=1;return O},{});if(L.unread_thread_ids)J._unreadThreadIDs=L.unread_thread_ids.reduce(function(O,P){O[P]=1;return O},{});if(L.request_count&&J._requestsJewel)J._initJewelCount(J._requestsJewel,L.request_count,J._markRequestsRead);if(L.unseen_thread_ids||L.diode_badgeable_qp_count){var M=L.unseen_thread_ids?L.unseen_thread_ids.length:0,N=M+(L.diode_badgeable_qp_count?L.diode_badgeable_qp_count:0);if(L.diode_badgeable_qp_count)J._diodeBadgeableQPCount=L.diode_badgeable_qp_count;J._initJewelCount(J._messagesJewel,N,J._markMessagesRead)}if(L.notification_count)J._initJewelCount(J._notificationsJewel,L.notification_count,J._markNotificationsSeen)},initJewels:function K(L,M){if(J._haveInitializedJewels)return;J._haveInitializedJewels=true;x.initialize();J.createJewels(M||{});if(J._requestsJewel){if(!J._friendRequestAddListener)J._friendRequestAddListener=C.listen("jewel_requests_add",null,J.updateFriendRequests);if(!J._friendRequestRemoveListener)J._friendRequestRemoveListener=C.listen("jewel_requests_remove_old",null,J.updateFriendRequests);if(!J._friendAcceptedListener)J._friendAcceptedListener=C.listen("jewel_friending_notifs",null,J.updateFriendRequests);if(!J._friendRequestSeenListener)J._friendRequestSeenListener=C.listen("friend_requests_seen",null,J.markFriendRequestsSeen)}if(!J._notificationListener)J._notificationListener=C.listen("m_notification",null,J.updateNotification);if(!J._notificationRefreshListener)J._notificationRefreshListener=C.listen("m:jewel-set:notifications-jewel:refresh-flyout",null,J.refreshNotificationsConstraints);if(!J._messageListener)J._messageListener=C.listen(j.MESSAGE,null,J.updateMessage);if(!J._messageCountListener)J._messageCountListener=C.listen(j.MESSAGE,null,J.updateMessageCounts);if(!J._notifReadListener)J._notifReadListener=C.listen("notifications_read",null,J.updateUnseenNotificationIds);if(!J._notifSeenListener)J._notifSeenListener=C.listen("notifications_seen",null,J.updateUnseenNotificationIds);if(!J._friendRequestResponseListener)J._friendRequestResponseListener=C.listen("m:requests:refresh",null,function(){var N=J._hasCombinedTab?"notifications_flyout":"reqs_flyout";A.getInstance(N).refreshConstraints()});if(!J._orientationChangeListener)J._orientationChangeListener=C.listen("m:viewport:orientation-change",null,J._onOrientationChange)},_onOrientationChange:function K(){setTimeout(function(){var L=A._activePopover;if(!L)return;if(z.getHeight()+"px"!==L.flyout.style.minHeight)L.refreshConstraints()},800)}};(function(){C.listen("m:jewels:init-counts",null,J._initJewelCounts);q.replayMissedEvents()})();f.exports=J}),null);
__d("MJewelNotifications",["Bootloader","ChannelEventType","MRequest","MURI","Run","Stratcom","SubscriptionsHandler","isFacebookURI"],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";function p(q){this.$MJewelNotifications1=q;this.$MJewelNotifications2=[];this.$MJewelNotifications3=false;this.$MJewelNotifications4=false;this.$MJewelNotifications5=new n();this.$MJewelNotifications5.addSubscriptions(l.onLeave(function(){this.$MJewelNotifications5.release()}.bind(this)),m.listen(i.NOTIFICATIONS_NEW,null,this.onNotificationReceive.bind(this)))}p.prototype.getNotifications=function(){return this.$MJewelNotifications2};p.prototype.registerListeners=function(){this.$MJewelNotifications5.addSubscriptions(m.listen(i.NOTIFICATIONS_READ,null,this.onNotificationRead.bind(this)),m.listen("click","live-notifications",this.onNotificationClick.bind(this)),m.listen("m:jewel:flyout:open",null,this.onJewelOpen.bind(this)))};p.prototype.onJewelOpen=function(event){var q=event.getData(),r=q&&q.jewel&&q.jewel==="notifications";if(r&&this.$MJewelNotifications4)this.updateUI()};p.prototype.onNotificationClick=function(event){var q=event.getNode("live-notification");if(!q)return;var r=q.getAttribute("data-alertid");this.readNotification(r);this.updateUI();new j("/a/jewel_notifications_log.php").addData({click_type:"jewel_notif_click",id:r}).send()};p.prototype.onNotificationRead=function(event){var q=event.getData();if(q&&q.alert_ids){q.alert_ids.forEach(function(r){this.readNotification(r)}.bind(this));this.updateUI()}};p.prototype.readNotification=function(q){this.$MJewelNotifications2.forEach(function(r){if(r.alert_id==q){if(r.unread)this.$MJewelNotifications4=true;r.unread=false}}.bind(this))};p.prototype.addNotification=function(q){this.$MJewelNotifications2=this.$MJewelNotifications2.filter(function(r){return r.alert_id!==q.alert_id});q.timestamp=Date.now();this.$MJewelNotifications2.push(q);this.$MJewelNotifications4=true};p.prototype.onNotificationReceive=function(event){var q=event.getData();if(q&&q.data){if(q.data.type==="friend_confirmed")return;if(!this.$MJewelNotifications3){this.$MJewelNotifications3=true;this.registerListeners()}this.addNotification(q.data);this.updateUI()}};p.prototype.updateUI=function(){if(!this.$MJewelNotifications3||!this.$MJewelNotifications4)return;h.loadModules(["React","ReactDOM","MJewelNotificationList.react","Popover"],function(q,r,s,t){if(!t.getInstance("notifications_flyout").isOpen())return;var u={notifications:this.$MJewelNotifications2};r.render(q.createElement(s,u),this.$MJewelNotifications1);t.getInstance("notifications_flyout").refreshConstraints();this.$MJewelNotifications4=false}.bind(this),"MJewelNotifications")};f.exports=p}),null);
__d("MJewelThreads",["Bootloader","ChannelEventType","MessagingEvent","Stratcom"],(function a(b,c,d,e,f,g,h,i,j,k){"use strict";function l(m){this.$MJewelThreads1=m;this.$MJewelThreads2=[];this.$MJewelThreads3=false;this.$MJewelThreads4=false;k.listen(i.MESSAGE,null,this.onMessageEvent.bind(this))}l.prototype.getThreads=function(){return this.$MJewelThreads2};l.prototype.registerListeners=function(){k.listen("click","live-threads",this.onThreadClick.bind(this));k.listen("m:jewel:flyout:open",null,this.onJewelOpen.bind(this))};l.prototype.onJewelOpen=function(event){var m=event.getData(),n=m&&m.jewel&&m.jewel==="messages";if(n&&this.$MJewelThreads4)this.updateUI()};l.prototype.onThreadClick=function(event){var m=event.getNode("live-thread");if(!m)return;this.setThreadReadStatus(m.getAttribute("data-fbid"),m.getAttribute("data-canonical")==="true",true);this.updateUI()};l.prototype.onMessageEvent=function(event){var m=event.getData();if(m.parsedPayload){var n=m.parsedPayload;if(n.getFolder()!=="inbox")return;if(!this.$MJewelThreads3){this.$MJewelThreads3=true;this.registerListeners()}this.addThread(n)}else if(Object.prototype.hasOwnProperty.call(m,"mark_as_read")){m.other_user_fbids.forEach(function(p){this.setThreadReadStatus(p.toString(),true,m.mark_as_read)}.bind(this));m.thread_fbids.forEach(function(p){this.setThreadReadStatus(p.toString(),false,m.mark_as_read)}.bind(this));this.updateUI()}else if(m.event===j.READ&&m.is_sync){var o=!!m.message.other_user_fbid,p=o?m.message.other_user_fbid:m.message.thread_fbid;this.setThreadReadStatus(p,o,true);this.updateUI()}};l.prototype.addThread=function(m){this.$MJewelThreads2=this.$MJewelThreads2.filter(function(n){var o=n.isCanonicalThread()?n.getOtherUserFBID():n.getThreadFBID();return!this.isSameThread(o,m.isCanonicalThread(),m)}.bind(this));m.unread=m.isUnread();this.$MJewelThreads2.push(m);this.$MJewelThreads4=true;this.updateThreadImage(m)};l.prototype.updateThreadImage=function(m){h.loadModules(["MMessagesThreadMetadataCache","MShortProfiles"],function(n,o){if(m.hasThreadImage())n.get(m.getThreadFBID(),function(q){m.image_src=q.image_src;this.updateUI()}.bind(this));else{var p=m.isCanonicalThread()?m.getOtherUserFBID():m.getAuthorFBID();o.get(p,function(q){m.image_src=q.mThumbSrcSmall;this.updateUI()}.bind(this))}}.bind(this),"MJewelThreads")};l.prototype.setThreadReadStatus=function(m,n,o){this.$MJewelThreads2.forEach(function(p){if(this.isSameThread(m,n,p)){if(p.unread==o)this.$MJewelThreads4=true;p.unread=!o}}.bind(this))};l.prototype.isSameThread=function(m,n,o){var p=n?o.getOtherUserFBID():o.getThreadFBID();return m==p};l.prototype.updateUI=function(){if(!this.$MJewelThreads3||!this.$MJewelThreads4)return;h.loadModules(["React","ReactDOM","MJewelThreadList.react","Popover"],function(m,n,o,p){if(!p.getInstance("messages_flyout").isOpen())return;var q={threads:this.$MJewelThreads2};n.render(m.createElement(o,q),this.$MJewelThreads1);p.getInstance("messages_flyout").refreshConstraints();this.$MJewelThreads4=false}.bind(this),"MJewelThreads")};f.exports=l}),null);
__d("MQuickPromotion",["DOM","Stratcom"],(function a(b,c,d,e,f,g,h,i){var j=false,k=function k(){if(j)return;j=true;var l="m-promo-close";function m(event){var n=event.getNode("m-promo");h.hide(n)}i.listen("click",l,m)};g.main=k}),null);
__d("MPopoverClose",["Popover"],(function a(b,c,d,e,f,g,h){var i=function i(){if(h._activePopover)h._activePopover.close()};g.main=i}),null);